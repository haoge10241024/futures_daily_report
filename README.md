# 期货日报生成工具（AI赋能版）

[![Streamlit](https://img.shields.io/badge/Streamlit-FF4B4B?style=for-the-badge&logo=Streamlit&logoColor=white)](https://streamlit.io/)
[![Python](https://img.shields.io/badge/Python-3.9+-3776AB?style=for-the-badge&logo=python&logoColor=white)](https://www.python.org/)
[![License](https://img.shields.io/badge/License-MIT-green.svg?style=for-the-badge)](LICENSE)

## 📊 功能简介

这是一个专业的期货日报自动生成系统，支持全品种期货分析和智能新闻聚合，基于DeepSeek AI和Serper API驱动。

**Created by 7haoge (953534947@qq.com)**

---

## 🚀 快速开始

### 🌐 在线体验（推荐）
部署到Streamlit Cloud后，用户可以直接访问网页使用，无需安装。

### 💻 本地运行
```bash
# 1. 克隆项目
git clone https://github.com/您的用户名/futures-daily-report.git
cd futures-daily-report

# 2. 安装依赖
pip install -r requirements.txt

# 3. 运行程序
streamlit run 期货日报_AI增强专业版.py
```

### 📚 重要文档

| 文档 | 说明 |
|------|------|
| 🚀 [**快速部署指南**](快速部署指南.md) | 5分钟部署到Streamlit Cloud |
| 📁 [**GitHub部署准备**](GitHub部署准备说明.md) | 文件整理和上传指南 |
| 🔧 [**API配置说明**](API配置说明.md) | API密钥申请和配置 |
| 📖 [**Streamlit部署详解**](Streamlit部署指南.md) | 完整部署教程 |

---

## ✨ 主要特性

### v4.1 新闻资讯编辑版 🔥 **最新推荐**

1. **📰 新闻资讯编辑模块**
   - 在报告编辑区域新增"新闻资讯"编辑模块
   - 支持AI自动生成：智能筛选10-15条重要新闻
   - 支持手动编辑：删减、修改或补充新闻内容
   - 完全自由：可完全自定义新闻内容
   - 无字数限制：支持任意数量和长度

2. **🤖 AI智能筛选新闻**
   - 从商品新闻 + 8大维度数据中筛选
   - 5大筛选维度：相关性、时效性、重要性、完整性、独特性
   - 自动去重、格式统一
   - 只展示新闻主体内容
   - 自动标注引用[1][2][3]

3. **✂️ 灵活的编辑体验**
   - AI生成后可自由编辑
   - 可删除不需要的新闻
   - 可添加自己的新闻
   - 可调整新闻顺序
   - 可修改新闻表述

4. **📋 报告完整性**
   - 三大内容模块：行情描述 + 主要观点 + 新闻资讯
   - 全部支持AI生成 + 人工编辑
   - 新闻资讯为可选项，可留空
   - Word报告自动包含附录引用

---

### v4.0 8大维度专业分析版 ⭐ **专业推荐**

1. **📊 8大专业分析维度**
   - 技术面、基本面、资金面、产业链、政策面、进出口、市场情绪、风险因素
   - 结合库存、仓单、基差、期限结构、持仓席位、供需等数据
   - 完全通过联网搜索或数据接口获取
   - 每个维度2个关键词，每关键词2条数据，共32条专业信息

2. **📈 技术指标自动计算**
   - MA5/MA10/MA20移动平均线
   - MACD、RSI技术指标
   - 布林带上下轨
   - 基于真实市场数据计算

3. **🔒 真实性与时效性保障**
   - 四重约束机制，严禁编造
   - 所有数据可追溯
   - 日期参数全链路传递
   - 引用格式改为上标，并提供附录参考文献链接

4. **📄 报告内容深度与专业性**
   - 主要观点字数提升至300-400字
   - AI Prompt全面升级，引导AI进行系统性、多维度分析
   - 专业术语准确，逻辑严密
   - 符合机构级报告标准

---

### v3.2 真实性增强版

1. **🌍 宏观数据集成**
   - 实时获取美元指数、美联储利率、CPI等宏观数据
   - Serper API多关键词搜索（5大类15条信息）
   - 为市场分析提供宏观视角
   - 自动标注数据来源和日期

2. **🔒 真实性保障机制**
   - **四重约束机制** - Prompt中明确4条红线禁止编造
   - **日期全链路传递** - 确保所有数据匹配用户选择的日期
   - **数据来源追溯** - 每条新闻标注来源和日期
   - **温度参数降低** - 从0.3降至0.2，提高准确性

3. **📊 Prompt全面优化**
   - 行情描述：10项数据 + 5维度要求 + 4条约束
   - 主要观点：市场数据 + 商品新闻 + 宏观数据 + 6维度分析
   - 所有数字必须可追溯到输入数据
   - 明确禁止AI推测或编造信息

4. **⏱️ 时效性保障**
   - 目标日期参数全链路传递
   - 新闻搜索自动过滤日期范围
   - 宏观数据搜索包含日期关键词
   - 3次强调目标日期避免混淆

---

### v3.1 专业格式版 ⭐ **稳定推荐**

1. **📄 报告格式优化**
   - 标题改为"期货日报"（去除机构名称）
   - 章节顺序：市场走势回顾 → 主要观点 → 市场资讯
   - 新闻格式专业化，直接显示核心内容
   - 底部信息精简

2. **🎨 UI界面美化**
   - 标题"期货日报生成器（AI赋能版）"
   - 详细系统使用说明
   - 按钮大小优化
   - 作者信息更新

---

### v3.0 AI增强版功能

1. **🤖 AI智能生成**
   - **AI生成行情描述** - DeepSeek驱动，专业分析K线走势
   - **AI生成主要观点** - 综合市场数据和新闻，智能输出投资建议
   - 支持手动编辑，灵活调整
   - 200-300字专业内容

2. **📝 快捷输入方式**
   - 直接输入品种名称（铜、螺纹钢、PTA等）
   - 智能提示合约格式（CU2501、RB2501等）
   - 无需下拉选择，更快更便捷

3. **🌍 全品种支持**（继承v2.0）
   - ✅ 有色金属：铜、铝、锌、铅、镍、锡
   - ✅ 黑色金属：螺纹钢、热卷、铁矿石、焦炭、焦煤等
   - ✅ 能源化工：原油、PTA、甲醇、PVC、PP、橡胶等
   - ✅ 农产品：豆粕、豆油、玉米、白糖、棉花等
   - ✅ 贵金属：黄金、白银

4. **📰 增强新闻搜索**（继承v2.0）
   - 多源新闻聚合（东方财富、金融界、RSS订阅）
   - Serper API搜索支持（已内置）
   - 智能相关性评分
   - 自动去重排序

5. **📈 数据分析**
   - K线图自动生成
   - 日盘/夜盘走势分析
   - 涨跌幅自动计算
   - Session状态管理

6. **📄 专业报告**
   - Word格式导出
   - 图文并茂
   - AI辅助内容生成
   - 可自定义编辑

## 🚀 快速开始

### 1. 安装依赖

```bash
cd 期货日报
pip install -r requirements.txt
```

### 2. 启动应用

**v3.2 真实性增强版（最新，推荐）：**🔥
```bash
streamlit run 期货日报_AI增强专业版.py
# 或双击: 启动_AI增强专业版.bat
```

**v3.0 AI增强版：**⭐
```bash
streamlit run 期货日报_AI增强版.py
# 或双击: 启动_AI增强版.bat
```

**v2.0 改进版：**
```bash
streamlit run 期货日报_改进版.py
```

**v1.0 原始版：**
```bash
streamlit run 期货日报.py
```

### 3. 使用说明

#### v3.2 真实性增强版（最新推荐）🔥

1. **输入基本信息**
   - 选择日期（确保是有交易的日期）
   - 输入品种名称（如：铜、黄金、螺纹钢）
   - 输入合约代码（如：CU2501、AU2506、RB2501）

2. **生成K线图**
   - 点击"生成K线图"
   - 自动显示日盘和夜盘数据
   - 自动获取相关新闻（带日期过滤）

3. **AI智能生成（增强版）**
   - **AI生成行情描述**
     - 基于真实行情数据
     - 严格四重约束机制
     - 所有数字可追溯
   
   - **AI生成主要观点**
     - 自动获取5类宏观数据（美元指数、美联储利率、CPI等）
     - 综合商品新闻和宏观数据分析
     - 六维度专业分析（市场表现、新闻面、情绪、技术面、操作建议、风险提示）
     - 所有观点都有数据来源
   
   - 可手动编辑AI生成的内容

4. **生成日报**
   - 点击"生成完整日报"
   - 自动保存到桌面/期货日报文件夹
   - Word格式，专业排版

#### v3.0 AI增强版⭐

1. **输入基本信息**
   - 选择日期
   - 输入品种名称（如：铜、螺纹钢）
   - 输入合约代码（如：CU2501、RB2501）

2. **生成K线图**
   - 点击"生成K线图"
   - 自动显示日盘和夜盘数据

3. **AI智能生成**
   - 点击"AI生成行情描述" - 自动生成专业市场描述
   - 点击"AI生成主要观点" - 综合分析生成投资观点
   - 可手动编辑AI生成的内容

4. **生成日报**
   - 点击"生成完整日报"
   - 下载Word文档

#### v2.0 改进版

1. 选择日期和品种类别
2. 从下拉列表选择品种
3. 输入完整合约代码
4. 生成K线图
5. 手动编辑内容
6. 生成日报

### 4. API配置

#### v4.1+ 支持本地开发和在线部署 🔥

**本地开发（方式1）：环境变量**
```bash
# Windows (PowerShell)
$env:DEEPSEEK_API_KEY="sk-your-key"
$env:SERPER_API_KEY="your-key"
streamlit run 期货日报_AI增强专业版.py

# Linux/Mac
export DEEPSEEK_API_KEY="sk-your-key"
export SERPER_API_KEY="your-key"
streamlit run 期货日报_AI增强专业版.py
```

**本地开发（方式2）：侧边栏输入**
- 启动应用后，在左侧边栏输入API密钥
- 系统实时显示配置状态

**在线部署（Streamlit Cloud）：**
- ✅ 无需配置环境变量
- ✅ 用户在网页侧边栏输入自己的API密钥
- ✅ 每个用户使用自己的密钥
- ✅ 更安全、更灵活

**API申请：**
- **DeepSeek API：** https://platform.deepseek.com/（新用户免费额度）
- **Serper API：** https://serper.dev/（新用户2,500次免费搜索）

**详细说明：**
- 📄 [API配置说明](API配置说明.md)
- 🚀 [Streamlit部署指南](Streamlit部署指南.md)

#### v3.0 AI增强版（已过时）
~~系统已内置API密钥（仅适用于本地开发，不适合公开部署）~~

## 📦 依赖说明

- `streamlit` - Web应用框架
- `akshare` - 金融数据接口
- `pandas` - 数据处理
- `matplotlib` - 绘图库
- `mplfinance` - K线图
- `python-docx` - Word文档生成
- `requests` - HTTP请求
- `beautifulsoup4` - 网页解析
- `feedparser` - RSS订阅解析

## 🔄 版本对比

| 功能 | v1.0 | v2.0 | v3.0 | v3.2 | v4.0 | v4.1 🔥 |
|-----|------|------|------|------|------|---------|
| **品种支持** | 6个 | 50+ | 50+ | 50+ | 50+ | 50+ |
| **输入方式** | 下拉 | 下拉 | 快捷 | 快捷 | 快捷 | 快捷 |
| **新闻来源** | 单一 | 多源 | 多源 | 多源+宏观 | 多源+8维度 | 多源+8维度 |
| **AI生成行情** | ❌ | ❌ | ✅ | ✅强约束 | ✅强约束 | ✅强约束 |
| **AI生成观点** | ❌ | ❌ | ✅ | ✅六维度 | **✅八维度** | **✅八维度** |
| **AI生成新闻** | ❌ | ❌ | ❌ | ❌ | ❌ | **✅可编辑** |
| **技术指标** | ❌ | ❌ | ❌ | ❌ | **✅自动计算** | **✅自动计算** |
| **专业数据** | ❌ | ❌ | ❌ | ❌ | **✅8大维度32条** | **✅8大维度32条** |
| **新闻编辑** | ❌ | ❌ | ❌ | ❌ | ❌ | **✅完全可控** |
| **引用格式** | ❌ | ❌ | ❌ | ✅上标 | ✅上标+附录 | ✅上标+附录 |
| **数据追溯** | ❌ | ❌ | ❌ | ✅全标注 | ✅全标注 | ✅全标注 |
| **真实性约束** | ❌ | ❌ | 基础 | ✅四重 | ✅四重 | ✅四重 |
| **Temperature** | N/A | N/A | 0.3 | 0.2 | 0.2/0.1 | 0.1/0.2 |
| **观点字数** | N/A | N/A | 150-200 | 200-280 | **300-400** | **300-400** |
| **报告内容** | 2部分 | 2部分 | 2部分 | 3部分 | 3部分 | **3部分可编辑** |
| **专业性** | ⭐⭐ | ⭐⭐⭐ | ⭐⭐⭐⭐ | ⭐⭐⭐⭐ | **⭐⭐⭐⭐⭐** | **⭐⭐⭐⭐⭐** |
| **灵活性** | ⭐⭐ | ⭐⭐⭐ | ⭐⭐⭐⭐ | ⭐⭐⭐⭐ | ⭐⭐⭐⭐ | **⭐⭐⭐⭐⭐** |

**推荐版本：**
- 🚀 **追求极致专业 + 灵活控制** → v4.1（最新版）
- 📊 **追求极致专业性** → v4.0
- ⚡ **日常快速使用** → v3.2
- 🎯 **简单易用** → v3.0

## 📝 使用示例

### 示例1：生成生猪期货日报（v4.1 新闻编辑版）🔥 **最新**

```
1. 选择日期：2025-10-10
2. 输入品种名称：生猪
3. 输入合约代码：LH2511
4. 点击"生成K线图"
   - 自动获取K线数据
   - 自动搜索商品新闻（带日期过滤）
5. 点击"AI生成行情描述"
   - 基于真实行情数据
   - 四重约束机制确保准确性
6. 点击"AI生成主要观点（专业版）"
   - 计算技术指标（MA、MACD、RSI、布林带）
   - 搜索8大维度专业数据（库存、基差、持仓等）
   - 综合分析生成300-400字专业观点
7. 点击"AI生成新闻资讯" ⭐ NEW
   - AI自动筛选10-15条重要新闻
   - 包含商品新闻 + 8大维度数据
   - 格式统一，自动标注引用[1][2][3]
8. 编辑新闻内容（可选）⭐ NEW
   - 删除不需要的新闻
   - 修改新闻表述
   - 添加自己的新闻
   - 调整新闻顺序
9. 生成完整日报
   - 自动保存到桌面/期货日报文件夹
   - 包含附录：参考文献
```

**输出效果：**
- ✅ 三大模块全部支持AI生成 + 人工编辑
- ✅ 新闻10-15条，精选重要资讯
- ✅ 技术指标 + 8大维度专业分析
- ✅ 300-400字深度观点
- ✅ 完全可控的内容编辑
- ✅ 机构级专业报告

---

### 示例2：生成黄金期货日报（v3.2 真实性增强版）
```
1. 选择日期：2025-10-13（确保是交易日）
2. 输入品种名称：黄金
3. 输入合约代码：AU2506
4. 点击"生成K线图"
   - 自动获取K线数据
   - 自动搜索商品新闻（带日期过滤）
5. 点击"AI生成行情描述"
   - 基于真实行情数据
   - 四重约束机制确保准确性
   - 所有价格可追溯
6. 点击"AI生成主要观点"
   - 自动搜索5类宏观数据（美元、利率、ETF、CPI、央行购金）
   - 综合商品新闻和宏观数据
   - 六维度专业分析（200-280字）
7. 微调内容（可选）
8. 生成完整日报
   - 自动保存到桌面/期货日报文件夹
   - 专业机构级格式
```

**输出效果：**
- ✅ 所有数字都有来源
- ✅ 每条新闻标注来源和日期
- ✅ 宏观数据支撑分析
- ✅ 操作建议明确可行
- ✅ 风险提示具体清晰

### 示例2：生成铜期货日报（v3.0 AI增强版）⭐
```
1. 输入品种名称：铜
2. 输入合约代码：CU2501
3. 点击"生成K线图"
4. 点击"AI生成行情描述"（自动生成）
5. 点击"AI生成主要观点"（自动生成）
6. 微调内容（可选）
7. 生成完整日报
```

### 示例3：生成螺纹钢期货日报（v3.0）
```
1. 输入品种名称：螺纹钢
2. 输入合约代码：RB2501
3. 生成K线图
4. AI辅助生成内容
5. 生成日报
```

### 示例4：传统方式（v2.0 改进版）
```
1. 品种类别：黑色金属
2. 品种：螺纹钢
3. 合约代码：RB2501
4. 生成K线图 → 手动编辑内容 → 生成日报
```

## ⚠️ 注意事项

1. 合约代码必须正确（如：CU2408、RB2501）
2. 数据获取需要稳定的网络连接
3. 首次使用建议先测试K线图生成
4. 报告保存在桌面的"期货日报"文件夹中

## 🆘 常见问题

**Q: AI生成功能无法使用？**
A: v3.0版本已内置API密钥，无需配置。如仍有问题，检查网络连接

**Q: AI生成的内容不满意？**
A: 可以手动编辑AI生成的内容，或点击重新生成

**Q: K线图无法生成？**
A: 检查合约代码格式是否正确（如：CU2501），确保合约在交易时段有数据

**Q: 新闻搜索没有结果？**
A: v3.0版本已内置Serper API，会自动搜索。网络不稳定时可能需要稍等

**Q: 品种名称输入有什么要求？**
A: 直接输入中文名称即可，如：铜、螺纹钢、PTA、豆粕等

**Q: 如何选择版本？**
A: 
- **需要AI功能** → v3.0 AI增强版（推荐）
- **只要多品种支持** → v2.0 改进版
- **只做有色金属** → v1.0 原始版

## 📧 联系方式

如有问题或建议，请联系恒力期货上海分公司
